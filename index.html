<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voca Robot Chatbot</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1f1c2c, #928dab);
    color: white;
  }
  h1 { text-align: center; padding: 20px; }
  .container { display: flex; flex-wrap: wrap; justify-content: center; padding: 20px; }
  .left, .right { padding: 10px; box-sizing: border-box; }
  .left { flex: 1 1 300px; max-width: 400px; text-align: center; }
  .left img { max-width: 100%; border-radius: 10px; }
  .right { flex: 2 1 400px; max-width: 700px; display: flex; flex-direction: column; }
  #chat {
    flex: 1;
    overflow-y: auto;
    max-height: 500px;
    padding: 10px;
    border: 2px solid #fff;
    border-radius: 10px;
    background: rgba(0,0,0,0.3);
  }
  .message { margin: 5px 0; padding: 8px 12px; border-radius: 12px; max-width: 80%; }
  .user { background: #00bfff; align-self: flex-end; color: black; }
  .bot { background: #ffb347; align-self: flex-start; color: black; }
  #controls { margin-top: 10px; display: flex; gap: 10px; }
  button {
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
  }
  #speakBtn { background: #00bfff; color: white; }
  #stopBtn { background: red; color: white; }
  @media screen and (max-width: 768px) {
    .container { flex-direction: column; align-items: center; }
    .left, .right { max-width: 100%; }
  }
</style>
</head>
<body>

<h1>ü§ñ Voca - Voice Chatbot</h1>

<div class="container">
  <div class="left">
    <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExOGJoYXhra3ZxYnk1ZGdncmVpZHl5aXlwdGluMnQ5OWt6NGY1cGRicyZlcD12MV9naWZzX3NlYXJjaCZjdD1n/IrkQLzqp1O1R0Po3B3/giphy.gif" alt="Robot Face">
  </div>
  <div class="right">
    <div id="chat"></div>
    <div id="controls">
      <button id="speakBtn">üé§ Speak</button>
      <button id="stopBtn">‚èπ Stop</button>
    </div>
  </div>
</div>

<script>
const chat = document.getElementById('chat');
const speakBtn = document.getElementById('speakBtn');
const stopBtn = document.getElementById('stopBtn');

let recognition;
let utterance;

// Browser Speech Recognition
if('webkitSpeechRecognition' in window){
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';

  recognition.onresult = async function(event){
    const transcript = event.results[0][0].transcript;
    addMessage(transcript, 'user');
    await callGemini(transcript);
  }
}else{
  alert("Your browser does not support Speech Recognition.");
}

// Speak with browser TTS
function speak(text){
  if(utterance) window.speechSynthesis.cancel();
  utterance = new SpeechSynthesisUtterance(text);
  window.speechSynthesis.speak(utterance);
}

function addMessage(text, type){
  const msg = document.createElement('div');
  msg.className = 'message ' + type;
  msg.textContent = text;
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

// Backend API call
async function callGemini(prompt){
  addMessage("ü§ñ Voca is typing...", 'bot');
  try{
    const response = await fetch("https://voca-chatbot.pranav.repl.co/chat", { // ‚úÖ replace with your backend URL
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    if(!response.ok) throw new Error("Server error");
    
    const data = await response.json();
    const aiText = data.response || "Sorry, I didn't get that.";
    chat.lastChild.textContent = aiText; // replace "typing..." with response
    speak(aiText);
  }catch(err){
    chat.lastChild.textContent = "‚ö†Ô∏è Error connecting to AI.";
    console.error(err);
  }
}

speakBtn.onclick = () => { if(recognition) recognition.start(); }
stopBtn.onclick = () => {
  if(recognition) recognition.stop();
  if(utterance) window.speechSynthesis.cancel();
}
</script>

</body>
</html>
